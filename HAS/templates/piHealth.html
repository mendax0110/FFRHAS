{% extends "base.html" %}

{% block style %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Raspberry Pi System Health</h2>
  <div id="healthStatus" class="mt-3">
    <div class="spinner-border" role="status"><span class="visually-hidden">Lade...</span></div>
  </div>
  <button class="btn btn-primary mt-3" onclick="loadHealth()">Aktualisieren</button>
</div>
{% endblock %}

{% block src %}
<script>
async function loadHealth() {
  const statusDiv = document.getElementById('healthStatus');
  statusDiv.innerHTML = '<div class="spinner-border" role="status"><span class="visually-hidden">Lade...</span></div>';
  try {
    const res = await fetch('/pi/health');
    const data = await res.json();
    statusDiv.innerHTML = `
      <ul class="list-group">
        <li class="list-group-item"><strong>CPU Temperatur:</strong> ${data.cpu_temp.cpu_temp ?? 'n/a'} °C ${data.cpu_temp.ok ? '✅' : '❌'}</li>
        <li class="list-group-item"><strong>CPU Auslastung:</strong> ${data.cpu_usage.cpu_usage ?? 'n/a'} % ${data.cpu_usage.ok ? '✅' : '❌'}</li>
        <li class="list-group-item"><strong>Speicher:</strong> ${data.memory.memory_usage ?? 'n/a'} % ${data.memory.ok ? '✅' : '❌'}</li>
        <li class="list-group-item"><strong>Festplatte:</strong> ${data.disk.disk_usage ?? 'n/a'} % ${data.disk.ok ? '✅' : '❌'}</li>
        <li class="list-group-item"><strong>Netzwerk:</strong> ${data.network.network ? '✅' : '❌'}</li>
        <li class="list-group-item"><strong>GPIO Pin 18:</strong> ${data.gpio.gpio_18 ?? 'n/a'} ${data.gpio.error ? '❌' : '✅'}</li>
        <li class="list-group-item"><strong>Uptime:</strong> ${new Date(data.uptime.uptime * 1000).toISOString().substr(11, 8)}</li>
        <li class="list-group-item"><strong>System:</strong> ${data.system.platform} (${data.system.hostname})</li>
      </ul>
    `;
  } catch (e) {
    statusDiv.innerHTML = '<div class="alert alert-danger">Fehler beim Laden der Daten!</div>';
  }
}
document.addEventListener('DOMContentLoaded', loadHealth);
</script>
{% endblock %}